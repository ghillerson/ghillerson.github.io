<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="withMenu" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../" data-mc-conditions="Review.ReviewOff" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developer's Guide|Fundamentals">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="The Splice Machine MapReduce API provides a simple programmatic interface for using MapReduce with HBase and taking advantage of the transactional capabilities that Splice Machine provides." /><title>Splice Machine MapReduce API</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/SpliceTriPaneStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../index.html#OnPremise/Developers/MapReduceAPI.html">Open topic with navigation</a>
        </p>
        <div class="TopicContent">
            <h1>Splice Machine Map Reduce API</h1>
            <p>The Splice Machine MapReduce API&#160;provides a simple programming interface to the Map Reduce Framework that is integrated into Splice Machine. You can use MapReduce to import data, export data, or for purposes such as implementing machine learning algorithms. One likely scenario for using the Splice Machine MapReduce API is for customers who already have a Hadoop cluster, want to use Splice Machine as their transactional database, and need to continue using their batch MapReduce jobs.</p>
            <p>This topic includes a summary of the Java classes included in the API,&#160;and <a href="#Example">presents an example</a> of using the MapReduce API.</p>
            <h2>Splice Machine MapReduce API&#160;Classes</h2>
            <p>The Splice Machine MapReduce API&#160;includes the following key classes:</p>
            <table summary="Descriptions of the key classes in the Splie Machine MapReduce API.">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Class</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="CodeFont">SpliceJob</td>
                        <td>Creates a transaction for the MapReduce job.</td>
                    </tr>
                    <tr>
                        <td class="CodeFont">SMInputFormat</td>
                        <td>
                            <p class="noSpaceAbove">Creates an object that:</p>
                            <ul>
                                <li value="1"> uses Splice Machine to scan the table and decode the data</li>
                                <li value="2">returns an <span class="CodeFont">ExecRow</span> (typed data) object</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td class="CodeFont">SMOutputFormat</td>
                        <td>
                            <p class="noSpaceAbove">Creates an object that:</p>
                            <ul>
                                <li value="1"> writes to a buffered cache</li>
                                <li value="2">dumps the cache into Splice Machine </li>
                                <li value="3">returns an <span class="CodeFont">ExecRow</span> (typed data)&#160;object.</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td class="CodeFont">SpliceMapReduceUtil</td>
                        <td>A Helper class for writing MapReduce jobs in java; this class is used to initiate a mapper job or a reducer job, to set the number of reducers, and to add dependency jars.</td>
                    </tr>
                </tbody>
            </table>
            <p class="noteNote" data-mc-autonum="NOTE: &#160;"><span class="autonumber"><span class="noteAutoNum">NOTE: &#160;</span></span>Each transaction must manage its own commit and rollback operations.</p>
            <p>For information about and examples of using Splice Machine with HCatalog, see the Using Splice Machine with HCatalog topic in this book.</p>
            <h2><a name="Example"></a>Example of Using the Splice Machine MapReduce API</h2>
            <p>This topic describes using the Splice Machine MapReduce API, <span class="CodeFont">com.splicemachine.mrio.api</span>, a simple word count program that retrieves data from an input table, summarizes the count of initial character of each word, and writes the result to an output table.</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Define your input and output tables:</p>
                        <p class="indentLevel1">First, assign the name of the Splice Machine database table from which you want to retrieve data to a variable, and then assign a name for your output table to another variable:</p>
                        <p class="indentLevel1">
                            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
String inputTableName  = "WIKIDATA";
String outputTableName = "USERTEST";</pre>
                            </div>
                        </p>
                        <p class="indentLevel1">You can specify table names using the <span class="ItalicFont">&lt;schemaName&gt;.&lt;tableName&gt;</span> format; if you don't specify a schema name, the default schema is assumed.</p>
                    </li>
                    <li value="2">
                        <p class="topLevel">Create a new job instance:</p>
                        <p class="indentLevel1">You need to create a new job instance and assign a name to it:</p>
                        <p class="indentLevel1">
                            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
Configuration config = HBaseConfiguration.create();
Job job = new Job(config, "WordCount");</pre>
                            </div>
                        </p>
                    </li>
                    <li value="3">
                        <p class="topLevel">Initialize your mapper job:</p>
                        <p class="indentLevel1">We initialize our sample job using the <span class="CodeFont">initTableMapperJob</span> utility method:</p>
                        <div class="gistWrapperWide">
                            <script src="https://gist.github.com/ghillerson/47299df459c861073c06c74308dfc073.js">
                            </script>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel">Retrieve values within your map function:</p>
                        <p class="indentLevel1">Our sample <span class="CodeFont">map</span> function retrieves and parses a single row with specified columns. </p>
                        <div class="gistWrapperWide">
                            <script src="https://gist.github.com/ghillerson/ab897ca67fcc4430851a26feb06b0e66.js">
                            </script>
                        </div>
                    </li>
                    <li value="5">
                        <p class="topLevel">Manipulate and save the value with reduce function:</p>
                        <p class="indentLevel1">Our sample <span class="CodeFont">reduce</span> function manipulates and saves the value by creating an <span class="CodeFont">ExecRow</span> and filling in the row with the <span class="CodeFont">execRow.setRowArray</span> method. </p>
                        <div class="gistWrapperWide">
                            <script src="https://gist.github.com/ghillerson/ed97f9a83b98cfff7816d88396fd5bdc.js">
                            </script>
                        </div>
                    </li>
                    <li value="6">
                        <p class="topLevel">Commit or rollback the job:</p>
                        <p class="indentLevel1">If the job is successful, commit the transaction. </p>
                        <div class="preWrapper"><pre class="Example" xml:space="preserve">job.commit();</pre>
                        </div>
                        <p class="indentLevel1">If the job fails, roll back the transaction. </p>
                        <div class="preWrapper"><pre class="Example" xml:space="preserve">job.rollback();</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
        </div>
    </body>
</html>