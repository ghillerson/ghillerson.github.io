<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="withMenu" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../" data-mc-conditions="Review.ReviewOff" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developer's Guide|Fundamentals">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="How to access Splice Machine as a data source using HCatalog." /><title>Using HCatalog with Splice Machine</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/SpliceTriPaneStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../index.html#OnPremise/Developers/HCatalog.html">Open topic with navigation</a>
        </p>
        <div class="TopicContent">
            <h1>Using Splice Machine with HCatalog</h1>
            <p>Apache HCatalog is a metadata and table management system for the broader Hadoop platform. HCatalog’s table abstraction presents users with a relational view of data in the Hadoop distributed file system (HDFS) and ensures that users need not worry about where or in what format their data is stored. HCatalog supports reading and writing files in any format for which a SerDe (serializer-deserializer) can be written.</p>
            <p>Splice Machine integrates with HCatalog, allowing any HiveQL&#160;statements to read from (e.g. <span class="CodeFont">SELECT</span>)&#160;and write to (e.g. <span class="CodeFont">INSERT</span>)&#160;Splice Machine tables. You can also use joins and unions to combine native Hive tables with Splice Machine tables.</p>
            <p class="noteTip" data-mc-autonum="TIP: &#160;"><span class="autonumber"><span class="noteAutoNum">TIP: &#160;</span></span>You can find extensive information about HCatalog on the <a href="https://hive.apache.org/" target="_blank">Apache Hive web site</a>.</p>
            <p>Also note that you can also take advantage of our HCatalog integration to access your Splice Machine tables for reading and writing from any database that features HCatalog integration, such as <span class="ItalicFont">MongoDB</span>.</p>
            <h2>Using HCatalog with a Splice Machine Table</h2>
            <p>To use HCatalog with&#160;Splice Machine, you connect a Hive table with a Splice Machine table using the HiveQL <span class="CodeFont">CREATE&#160;EXTERNAL&#160;TABLE</span>&#160;statement. In Hive, an external table can point to any HDFS&#160;location for its storage; in this case, the table is located in your Splice&#160;Machine database.</p>
            <p> For example, here's a HiveQL&#160;statement that creates a table named <span class="CodeFont">extTest1</span> that is connected with the <span class="CodeFont">hcattest</span>&#160;table in a Splice Machine database:</p>
            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">hive&gt; CREATE EXTERNAL TABLE extTest1(col1 int, col2 varchar(20))
   STORED BY 'com.splicemachine.mrio.api.hive.SMStorageHandler'
   TBLPROPERTIES ("splice.jdbc"="jdbc:splice://localhost:1527/splicedb\;user=<span class="Highlighted">splice</span>\;password=<span class="Highlighted">admin</span>", "splice.tableName"="TEST.hcattest");</pre>
            </div>
            <p>Your table definition must include:</p>
            <ul>
                <li value="1">The <span class="CodeFont">STORED&#160;BY</span>&#160;clause as shown, which allows the table to connect with Splice Machine.</li>
                <li value="2">The <span class="CodeFont">TBLPROPERTIES</span>&#160;clause, which specifies:<ul class="SecondLevel"><li value="1"><p>The JDBC&#160;connection you are using. include your access <span class="HighlightedCode">user</span> ID and <span class="HighlightedCode">password</span>.</p><p class="noteNote" data-mc-autonum="NOTE: &#160;"><span class="autonumber"><span class="noteAutoNum">NOTE: &#160;</span></span>If you are running Splice Machine on a cluster, connect from a machine that is NOT&#160;running an HBase RegionServer and specify the IP&#160;address of a <span class="HighlightedCode">regionServer</span> node, e.g. <span class="AppCommand">10.1.1.110</span>. <br /><br />Use <span class="CodeFont">localhost</span> if you're running the standalone version of Splice Machine.</p></li><li value="2">The name of the table in your Splice Machine database with which you are connecting the Hive table. </li></ul></li>
            </ul>
            <h3><a name="How"></a>How Splice Machine Maps Columns</h3>
            <p>If your Hive table contains a different number of columns than does your Splice Machine database table, Splice Machine maps the columns. </p>
            <p>For example, if your Hive table has three columns defined, and your Splice Machine table has four columns defined, then Splice Machine maps the three Hive columns into the first three columns in the Splice Machine table, as shown here:</p>
            <div>
                <img src="../../Resources/Images/HiveMap.png" class="indented" alt="Diagram of how Splice Machine maps Hive tables" />
            </div>
            <h3><a name="Using"></a>Using HiveQL&#160;to Join Tables From Different Data Resources </h3>
            <p>You can use HiveQL to join tables that point to different data resources. The Java class provided by Splice Machine allows you to include tables from your Splice Machine database in such joins, as illustrated here:        </p>
            <div>
                <img src="../../Resources/Images/HiveJoin.png" class="indented" alt="Diagram of using HiveQL for joining tables" />
            </div>
            <p>For more information about Hive joins, see the Apache Hive documentation. </p>
            <h2>Examples</h2>
            <p>This section contains several simple examples of using HCatalog.        </p>
            <h3>Example 1:&#160;Simple Example</h3>
            <p>This is a simple example of creating an external table in Hive that maps directly to a Splice Machine table.</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Create the Splice Machine table</p>
                        <p class="indentLevel1">This example uses a very simple Splice Machine database table, <span class="CodeFont">hcattest</span>, which we create with these statements:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;create table hcattest(col1 int, col2 varchar(20));
splice&gt;&#160;insert into hcattest values(1, 'row1');
splice&gt;&#160;insert into hcattest values(2, 'row2');
splice&gt;&#160;insert into hcattest values(3, 'row3');
splice&gt;&#160;insert into hcattest values(4, 'row4');
</pre>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel">Verify the table</p>
                        <p class="indentLevel1">Verify that <span class="CodeFont">hcattest</span> is set up correctly:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;describe hcattest;
COLUMN_NAME |&#160;TYPE_NAME&#160;|&#160;DES&amp;|NUM&amp;|COLUMN&amp;|COLUMN_DEF|CHAR_OCTE&amp;|IS_NULL&amp;
--------------------------------------------------------------------------
COL1        |INTEGER    |0    |10  |10     |NULL      |NULL      |YES
COL2        |VARCHAR    |NULL |NULL|20     |NULL      |40        |YES

2 rows selected
splice&gt;&#160;select * from hcattest;
COL1        |COL2
-------------------------------
1            row1
2            row2
3            row3
4            row4

4 rows selected</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Create an external table in Hive</p>
                        <p class="indentLevel1">You need to create an external table in Hive, and connect that table with the Splice Machine table you just created. Type the following command into the Hive shell, substituting your <span class="HighlightedCode">user</span> ID&#160;and <span class="HighlightedCode">password</span>. </p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">hive&gt; CREATE EXTERNAL TABLE extTest1(col1 int, col2 varchar(20))
   STORED BY 'com.splicemachine.mrio.api.hive.SMStorageHandler'
   TBLPROPERTIES ("splice.jdbc"="jdbc:splice://localhost:1527/splicedb\;user=<span class="Highlighted">splice</span>\;password=<span class="Highlighted">admin</span>", "splice.tableName"="SPLICE.hcattest");</pre>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel">Use HiveQL&#160;to select data in the Splice Machine table</p>
                        <p class="indentLevel1">Once you've created your external table, you can use <span class="CodeFont">SELECT</span> statements in the Hive shell to retrieve data from Splice Machine table. For example:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">hive&gt;&#160;select *&#160;from extTest1;
OK
1<span class="bodyFont">→</span>row 1
2<span class="bodyFont">→</span>row 2
3<span class="bodyFont">→</span>row 3
4<span class="bodyFont">→</span>row 4</pre>
                        </div>
                        <p class="indentLevel1"> If the external&#160;table that you created does not have the same number of columns as are in your Splice Machine table, then the Hive table's columns are mapped to columns in the Splice&#160;Machine table, as described in <a href="#How">How Splice Machine Maps Columns</a>, above.</p>
                    </li>
                </ol>
            </div>
            <h3>Example 2:&#160;Table with Primary Key</h3>
            <p>This example uses a Splice Machine table, <span class="CodeFont">tblA</span>, that has only string types and a primary key.</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Create and verify the Splice Machine table</p>
                        <p class="indentLevel1">This example uses a simple Splice Machine database table that we've created, <span class="CodeFont">tblA</span>, which we verify:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;describe tblA;
COLUMN_NAME |&#160;TYPE_NAME&#160;|&#160;DES&amp;|NUM&amp;|COLUMN&amp;|COLUMN_DEF|CHAR_OCTE&amp;|IS_NULL&amp;
--------------------------------------------------------------------------
COL1        |CHAR&#160;&#160;&#160;&#160;   |NULL |NULL|20     |NULL      |40        |YES
COL2        |VARCHAR    |NULL |NULL|56     |NULL      |112       |YES

2 rows selected
splice&gt;&#160;select * from tblA;
COL1        |COL2
-------------------------------
char         varchar 2
char 1       varchar 1

2 rows selected</pre>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel">Create an external table in Hive</p>
                        <p class="indentLevel1">You need to create an external table in Hive, and connect that table with the Splice Machine table you just created. Type the following command into the Hive shell, substituting your <span class="HighlightedCode">user</span> ID&#160;and <span class="HighlightedCode">password</span>. </p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">hive&gt; CREATE EXTERNAL TABLE extTest2(col1 String, col2 varchar(56))
   STORED BY 'com.splicemachine.mrio.api.hive.SMStorageHandler'
   TBLPROPERTIES ("splice.jdbc"="jdbc:splice://localhost:1527/splicedb\;user=<span class="Highlighted">splice</span>\;password=<span class="Highlighted">admin</span>", "splice.tableName"="SPLICE.tblA");</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Use HiveQL&#160;to select data in the Splice Machine table</p>
                        <p class="indentLevel1">Once you've created your external table, you can use <span class="CodeFont">SELECT</span> statements in the Hive shell to retrieve data from Splice Machine table. For example:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">hive&gt;&#160;select *&#160;from extTest2;
OK
char  <span class="bodyFont">→</span>varchar 2
char 1<span class="bodyFont">→</span>varchar 1</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <h3>Example 3:&#160;Table with No Primary Key</h3>
            <p>This example uses a Splice Machine table, <span class="CodeFont">tblB</span>, that has a primary key and uses integer columns.</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Create and verify the Splice Machine table</p>
                        <p class="indentLevel1">This example uses a simple Splice Machine database table that we've created, <span class="CodeFont">tblA</span>, which we verify:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;describe tblA;
COLUMN_NAME |&#160;TYPE_NAME&#160;|&#160;DES&amp;|NUM&amp;|COLUMN&amp;|COLUMN_DEF|CHAR_OCTE&amp;|IS_NULL&amp;
--------------------------------------------------------------------------
COL1        |INTEGER&#160;   |0    |10  |10     |NULL      |NULL      |NO
COL2        |INTEGER&#160;   |0    |10  |10     |NULL      |NULL      |YES
COL3        |INTEGER&#160;   |0    |10  |10     |NULL      |NULL      |NO

3 rows selected
splice&gt;&#160;select * from tblB;
COL1        |COL2       |COL3
-------------------------------
1           |1          |1
2           |2          |2

2 rows selected</pre>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel">Create an external table in Hive</p>
                        <p class="indentLevel1">You need to create an external table in Hive, and connect that table with the Splice Machine table you just created. Type the following command into the Hive shell, substituting your <span class="HighlightedCode">user</span> ID&#160;and <span class="HighlightedCode">password</span>. </p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">hive&gt; CREATE EXTERNAL TABLE extTest3(col1 String, col2 varchar(56))
   STORED BY 'com.splicemachine.mrio.api.hive.SMStorageHandler'
   TBLPROPERTIES ("splice.jdbc"="jdbc:splice://localhost:1527/splicedb\;user=<span class="Highlighted">splice</span>\;password=<span class="Highlighted">admin</span>", "splice.tableName"="SPLICE.tblB");</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Select data from the Splice Machine input table</p>
                        <p class="indentLevel1">Once you've created your external table, you can use <span class="CodeFont">SELECT</span> statements in the Hive shell to retrieve data from Splice Machine input table. table. For example:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">hive&gt;&#160;select *&#160;from extTest3;
OK
1<span class="bodyFont">→</span>1<span class="bodyFont">→</span>1
1<span class="bodyFont">→</span>2<span class="bodyFont">→</span>2</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
        </div>
    </body>
</html>