<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="withMenu" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../" data-mc-conditions="Review.ReviewOff" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Admin Guide">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="How to clean (flatten) your database." /><title>Cleaning (Flattening) Your Splice Machine Database</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Resources/Stylesheets/SpliceTriPaneStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../index.html#OnPremise/Administrators/CleaningDatabase.html">Open topic with navigation</a>
        </p>
        <div class="TopicContent">
            <h1>Cleaning Your Database</h1>
            <p>Cleaning your database essentially wipes out any user-defined tables, indexes, and related items. You need to follow different steps, depending on which version of Splice Machine you are using:</p>
            <ul>
                <li value="1"><a href="#CleaningDBCloudera">Cleaning Your Splice Machine Database on a Cloudera-Managed Cluster</a>
                </li>
                <li value="2"><a href="#CleaningDBHDP">Cleaning Your Splice Machine Database on a Hortonworks HDP-Managed Cluster</a>
                </li>
                <li value="3"><a href="#CleaningDBMapR">Cleaning Your Splice&#160;Machine Database on a MapR-Managed Cluster</a>
                </li>
                <li value="4"><a href="#CleaningDbStandalone">Cleaning Your&#160;Splice Machine Database on a Standalone installation</a>
                </li>
            </ul>
            <h2><a name="CleaningDBCloudera"></a><a name="kanchor152"></a>Cleaning Your Splice Machine Database on a Cloudera-Managed Cluster</h2>
            <p>Follow these steps to clean your database if you're using the Cloudera-managed cluster version of Splice Machine:</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Shut down HBase and HDFS</p>
                        <p class="indentLevel1">Navigate to  the 	<span class="AppCommand">Services-&gt;All Services</span> screen in <span>Cloudera Manager</span>, and select these actions to stop <span class="ItalicFont">HBase</span> and <span class="ItalicFont">HDFS</span>:
</p>
                        <div class="indented">
                            <div class="preWrapper"><pre class="AppCommand" xml:space="preserve"><span class="ItalicFont">hbase</span> -&gt; <span class="ItalicFont">Actions</span> -&gt; Stop
<span class="ItalicFont">hdfs1</span> -&gt; <span class="ItalicFont">Actions</span> -&gt; Stop
<span class="ItalicFont">zookeeper1</span> -&gt;&#160;<span class="ItalicFont">Actions</span> -&gt;&#160;Stop</pre>
                            </div>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel"> Use the Zookeeper client to clean things:</p>
                        <p class="indentLevel1">Restart ZooKeeper in the <span class="AppCommand">Services-&gt;All&#160;Services</span> screen:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve"><span class="ItalicFont">zookeeper1</span> -&gt;&#160;<span class="ItalicFont">Actions</span> -&gt;&#160;Start</pre>
                        </div>
                        <p class="indentLevel1">Log in to the machine running Zookeeper on your cluster and start up a command-line (terminal) window.</p>
                        <p class="indentLevel1">Run the <span class="ShellCommand">zookeeper-client</span> command. At the prompt, run the following commands:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">rmr /startupPath
rmr /spliceJobs
rmr /derbyPropertyPath
rmr /spliceTasks
rmr /hbase
rmr /conglomerates
rmr /transactions
rmr /ddl</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Start HDFS</p>
                        <p class="indentLevel1">Navigate to the <span class="AppCommand">Services-&gt;All Services</span> screen in <span>Cloudera Manager</span>, and restart <span class="ItalicFont">HDFS</span>:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve"><span class="ItalicFont">hdfs1</span> -&gt; <span class="ItalicFont">Actions</span> -&gt; Start</pre>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel"> Clean up HBase</p>
                        <p class="indentLevel1"><a name="kanchor153"></a>Use the following shell command to delete the existing <span class="CodeFont">/hbase</span> directory. You can run this command on any Data Node:</p>
                        <div class="preWrapper"><pre class="ShellCommand" xml:space="preserve">sudo -su hdfs hadoop fs -rm -r /hbase</pre>
                        </div>
                        <p class="indentLevel1">If you are logged in as root, use this command instead:</p>
                        <div class="preWrapper"><pre class="ShellCommand" xml:space="preserve">sudo -u hdfs hadoop fs -rm -r /hbase</pre>
                        </div>
                        <p class="noteNote" data-mc-autonum="NOTE: &#160;"><span class="autonumber"><span class="noteAutoNum">NOTE: &#160;</span></span>If the machine running Cloudera Manager is not part of the cluster, <span class="BoldFont">do not</span> run the command on that machine</p>
                    </li>
                    <li value="5">
                        <p class="topLevel"> Create a new HBase directory:</p>
                        <p class="indentLevel1">Navigate to  the 	<span class="AppCommand">HBase</span> screen in <span>Cloudera Manager</span>, and create a new <span class="CodeFont">/hbase</span> directory by selecting:
</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve"><span class="ItalicFont">Actions</span> -&gt; Create Root Directory</pre>
                        </div>
                    </li>
                    <li value="6">
                        <p class="topLevel">Restart HBase</p>
                        <p class="indentLevel1">Now restart HBase from the same <span class="AppCommand">Home-&gt;Services-&gt;hbase1</span> screen in Cloudera Manager, using this action:
</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve"><span class="ItalicFont">Actions</span> -&gt;&#160;Start</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <h2><a name="kanchor154"></a><a name="CleaningDBHDP"></a>Cleaning Your Splice Machine Database on a Hortonworks HDP-Managed Cluster</h2>
            <p>Follow these steps to clean (or <span class="ItalicFont">flatten</span>)&#160;your database if you're using Splice Machine on an Ambari-managed Hortonworks Cluster:</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Shut down HBase and HDFS</p>
                        <p class="indentLevel1">Log in to the Ambari Dashboard by pointing your browser to the publicly visible <span class="HighlightedCode">&lt;hostName&gt;</span>&#160;for your master node that is hosting Ambari Server:</p>
                        <div class="preWrapperWide"><pre class="ShellCommand" xml:space="preserve"><span class="ShellCommand">http://<span class="HighlightedCode">&lt;hostName&gt;</span>:8080/</span></pre>
                        </div>
                        <blockquote>
                            <div class="preWrapperWide"><pre class="ShellCommand" xml:space="preserve"><span class="ShellCommand">http://<span class="HighlightedCode">&lt;hostName&gt;</span>:8080/</span></pre>
                            </div>
                        </blockquote>
                        <p class="indentLevel1">Select these actions to stop HBase and HDFS:
:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">Services-&gt;HBase-&gt;Service&#160;Actions-&gt;Stop
Services-&gt;HDFS-&gt;Service Actions-&gt;Stop</pre>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel">Use the Zookeeper client to clean things</p>
                        <p class="indentLevel1">
                        Log in to the node running Zookeeper on your cluster and start up a command-line (terminal) window.
                        </p>
                        <p class="indentLevel1">Run the <span class="ShellCommand">zookeeper-client</span> command. At the prompt, run the following commands:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">rmr /startupPath
rmr /spliceJobs
rmr /derbyPropertyPath
rmr /spliceTasks
rmr /hbase-unsecure
rmr /conglomerates
rmr /transactions
rmr /ddl</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Restart HDFS</p>
                        <p class="indentLevel1">Use the Ambari Dashboard to restart HDFS:                        </p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">Services-&gt;HDFS-&gt;Service Actions-&gt;Start</pre>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel">Re-create the required directory structure</p>
                        <p class="indentLevel1">
                        You need to SSH&#160;into a node that is running the HDFS&#160;Client and re-create the directory structure that Splice&#160;Machine expects by issuing these commands:                        </p>
                        <p class="indentLevel1">Run the <span class="ShellCommand">zookeeper-client</span> command. At the prompt, run the following commands:</p>
                        <div class="preWrapperWide"><pre class="ShellCommand" xml:space="preserve">
sudo -su hdfs hadoop fs -rm -r /apps/hbase
sudo -su hdfs hadoop fs -mkdir /apps/hbase
sudo -su hdfs hadoop fs -mkdir /apps/hbase/data
sudo -su hdfs hadoop fs -chown hbase:hdfs /apps/hbase
sudo -su hdfs hadoop fs -chown hbase:hdfs /apps/hbase/data</pre>
                        </div>
                    </li>
                    <li value="5">
                        <p class="topLevel">Restart HBase</p>
                        <p class="indentLevel1">Use the Ambari Dashboard to restart HBase:                        </p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">Services-&gt;HBase-&gt;Service Actions-&gt;Start</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <h2><a name="kanchor155"></a><a name="CleaningDBMapR"></a>Cleaning Your Splice Machine Database on a MapR-Managed Cluster</h2>
            <p>Follow the steps below to clean (flatten)&#160;your database on your MapR cluster. You must be logged in as the cluster administrator (typically <span class="CodeFont">clusteradmin</span> or <span class="CodeFont">ec2-user</span>) to run each step. Unless otherwise specified, run each of these steps <span class="BoldFont">on your cluster control node</span>; some steps, as indicated, must be run on each node in your cluster.</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Stop the HBase RegionServers and Master:</p>
                        <p class="indentLevel1">Use the following command <span class="BoldFont">on your control node</span> to stop HBase on your cluster:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">~/splice-installer-mapr4.0/stop-hbase.sh</pre>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel"> Remove old data from HDFS:</p>
                        <p class="indentLevel1">Ignore any error messages you may see when you run this command:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">sudo -iu mapr hadoop fs -rm -r -f 'maprfs:///hbase/*'</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Stop MapR&#160;warden services:</p>
                        <p class="indentLevel1">Run the following command <span class="BoldFont">on each node</span> in your cluster:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">sudo service mapr-warden stop</pre>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel">Launch the ZooKeeper command line shell:</p>
                        <p class="indentLevel1">Note that the exact path may vary with different MapR&#160;versions</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">/opt/mapr/zookeeper/zookeeper-3.4.5/bin/zkCli.sh</pre>
                        </div>
                    </li>
                    <li value="5">
                        <p class="topLevel">Connect to the local ZooKeeper instance:</p>
                        <p class="indentLevel1">When the ZooKeeper command shell prompts you, enter the <span class="HighlightedCode">connect</span> command shown here:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">Connecting to localhost:2181
Welcome to ZooKeeper!
JLine support is enabled
[zk: localhost:2181(CONNECTING) 0] <span class="Highlighted">connect localhost:5181</span></pre>
                        </div>
                    </li>
                    <li value="6">
                        <p class="topLevel">Complete the connection:</p>
                        <p class="indentLevel1">Press <span class="CodeFont">Enter</span> again to display the connected prompt</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">[zk: localhost:5181(CONNECTED) 1]</pre>
                        </div>
                    </li>
                    <li value="7">
                        <p class="topLevel">Clear old ZooKeeper data:</p>
                        <p class="indentLevel1">Enter the following commands to clear ZooKeeper data and then exit the command shell:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">rmr /startupPath
rmr /spliceJobs
rmr /derbyPropertyPath
rmr /spliceTasks
rmr /hbase
rmr /conglomerates
rmr /transactions
rmr /ddl
quit</pre>
                        </div>
                    </li>
                    <li value="8">
                        <p class="topLevel">Restart MapR&#160;warden services on all nodes:</p>
                        <p class="indentLevel1">Run the following command <span class="BoldFont">on each node</span> in your cluster:</p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">sudo service mapr-warden start</pre>
                        </div>
                        <p class="indentLevel1">Once you do so, your cluster will re-create the Splice Machine schema, and the command line interface will once again be available after a minute or so.</p>
                    </li>
                    <li value="9">
                        <p class="topLevel">Restart HBase</p>
                        <p class="indentLevel1">Run this command to restart hbase:                        </p>
                        <div class="preWrapper"><pre class="AppCommand" xml:space="preserve">~/splice-installer-mapr4.0/start-hbase.sh</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <h2><a name="CleaningDbStandalone"></a>Cleaning Your Database in the Standalone Version<a name="kanchor156"></a></h2>
            <p>Follow these steps to clean your database if you're using the Standalone version of Splice Machine:</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Make sure that you have quit the <span class="AppCommand">splice&gt;</span>&#160;command line interpreter:</p>
                        <div class="preWrapper"><pre class="AppCommand">splice&gt; quit;</pre>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel"> Change directory to your install directory:</p>
                        <div class="preWrapper"><pre class="ShellCommand">cd splicemachine</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Run the following scripts:</p>
                        <div class="preWrapper"><pre class="ShellCommand" xml:space="preserve">
$ <span class="PlatformVariablesStandaloneStopScript">./bin/stop-splice.sh</span>
$ <span class="PlatformVariablesStandaloneCleanScript">./bin/clean.sh</span>
$ <span class="PlatformVariablesStandaloneStartScript">./bin/start-splice.sh</span></pre>
                        </div>
                    </li>
                </ol>
            </div>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
        </div>
    </body>
</html>