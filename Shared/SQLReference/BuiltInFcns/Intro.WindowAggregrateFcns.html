<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="reference" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-conditions="Review.ReviewOff" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="SQL Reference|SQL Built-in Functions">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="Summarizes the window and aggregate functions you can use to evaluate an expression over a set of rows in Splice Machine SQL." /><title>Window and Aggregate Functions in Splice Machine SQL</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Resources/Stylesheets/SpliceTriPaneStyles.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#Shared/SQLReference/BuiltInFcns/Intro.WindowAggregrateFcns.html">Open topic with navigation</a>
        </p>
        <div class="TopicContent">
            <h1><a name="kanchor201"></a>Window and Aggregate Functions</h1>
            <p>This section contains the Aggregate and Window (analytic)&#160;functions built into Splice Machine SQL.</p>
            <ul>
                <li value="1"><a href="#Aggregat">Aggregate functions</a>, which are sometimes referred to as set functions, provide a means of evaluating an expression over a set of rows. Each aggregate function outputs one value for the set of rows on which it operates. All aggregate functions can also be used as window functions.</li>
                <li value="2">
                    <p><a href="#Window">Window functions</a>, which are sometimes referred to as <span class="ItalicFont">analytic functions</span>, perform calculations across a set of table rows that are related to the current row. Each window function outputs one value for each row on which it operates. Some of the window functions <span class="ItalicFont">cannot</span> be used as aggregate functions. </p>
                    <p class="noteNote" data-mc-autonum="NOTE: &#160;"><span class="autonumber"><span class="noteAutoNum">NOTE: &#160;</span></span>A subset of the window functions are sometimes referred to as <span class="ItalicFont">ranking functions</span>, as noted below.</p>
                </li>
            </ul>
            <table summary="Summary of Splice Machine SQL Window and Aggregate Functions">
                <col />
                <col />
                <col />
                <col />
                <thead>
                    <tr>
                        <th><span class="BoldFont">Function Name</span>
                        </th>
                        <th>Window or Aggregate</th>
                        <th>Description</th>
                        <th>Permitted Data Types</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><span class="CodeFont"><a href="Avg.html">AVG</a></span>
                        </td>
                        <td>Both</td>
                        <td>Returns the average computed over a subset (partition) of a table.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="Count.html">COUNT</a></span>
                        </td>
                        <td>Both</td>
                        <td>Returns the number of rows in a partition.</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="DenseRank.html">DENSE_RANK</a></span>
                        </td>
                        <td>Window</td>
                        <td>A ranking function that returns the ranking of a row within a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="FirstValue.html">FIRST_VALUE</a></span>
                        </td>
                        <td>Window</td>
                        <td>Returns the first value within  a partition..</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="Lag.html">LAG</a></span>
                        </td>
                        <td>Window</td>
                        <td>Returns the value of an expression evaluated at a specified offset number of rows <span class="ItalicFont">before</span> the current row in a partition.</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="LastValue.html">LAST_VALUE</a></span>
                        </td>
                        <td>Window</td>
                        <td>Returns the last value within a partition..</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="Lead.html">LEAD</a></span>
                        </td>
                        <td>Window</td>
                        <td>Returns the value of an expression evaluated at a specified offset number of rows <span class="ItalicFont">after</span> the current row in a partition.</td>
                        <td>All types.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="Max.html">MAX</a></span>
                        </td>
                        <td>Both</td>
                        <td>Returns the maximum value computed over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="Min.html">MIN</a></span>
                        </td>
                        <td>Both</td>
                        <td>Returns the minimum value computed over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="Rank.html">RANK</a></span>
                        </td>
                        <td>Window</td>
                        <td>A ranking function that returns the ranking of a row within a subset of a table.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="RowNumber.html">ROW_NUMBER</a></span>
                        </td>
                        <td>Window</td>
                        <td>
                            <p>A ranking function that returns the row number of a row within a partition.</p>
                        </td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="StdDevPop.html">STDDEV_POP</a></span>
                        </td>
                        <td>Both</td>
                        <td>Returns the sum of a value calculated over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="StdDevSamp.html">STDDEV_SAMP
                        </a></span>
                        </td>
                        <td>Both</td>
                        <td>Returns the sum of a value calculated over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                    <tr>
                        <td><span class="CodeFont"><a href="Sum.html">SUM</a></span>
                        </td>
                        <td>Both</td>
                        <td>Returns the sum of a value calculated over a partition.</td>
                        <td>The <a href="#numeric_built-in_data_types_">numeric built-in data types</a>.</td>
                    </tr>
                </tbody>
            </table>
            <h3><a name="numeric_built-in_data_types_"></a>The Numeric Built-in Data Types</h3>
            <p class="indentLevel1">The numeric built-in data types are:&#160;<a href="../DataTypes/Decimal.html"><span class="CodeFont">DECIMAL</span></a>, <a href="../DataTypes/DoublePrecision.html"><span class="CodeFont">DOUBLE PRECISION</span></a>, <a href="../DataTypes/Float.html"><span class="CodeFont">FLOAT</span></a>, <a href="../DataTypes/Integer.html"><span class="CodeFont">INTEGER</span></a>, <a href="../DataTypes/BigInt.html"><span class="CodeFont">BIGINT</span></a>, <a href="../DataTypes/Numeric.html"><span class="CodeFont">NUMERIC</span></a>, <a href="../DataTypes/Real.html"><span class="CodeFont">REAL</span></a>, and <a href="../DataTypes/SmallInt.html"><span class="CodeFont">SMALLINT</span></a>.</p>
            <h2><a name="Aggregat"></a>Using Aggregate Functions</h2>
            <p>Aggregate functions (also described as <span class="ItalicFont">set functions</span> in ANSI SQL and as <span class="ItalicFont">column functions</span> in some database literature). They provide a means of evaluating an expression over a set of rows. </p>
            <p>Whereas the other built-in functions operate on a single expression, aggregates operate on a set of values and reduce them to a single scalar value. Built-in aggregates can calculate the minimum, maximum, sum, count, and average of an expression over a set of values as well as count rows. The following table shows the data types on which each built-in aggregate function can operate.</p>
            <p>Aggregates are permitted only in the following:</p>
            <ul>
                <li value="1">A <span class="ItalicFont">SelectItem</span> in a <span class="ItalicFont"><a href="../Expressions/Select.html">SelectExpression</a>.</span></li>
                <li value="2">A <a href="../Clauses/Having.html"><span class="CodeFont">HAVING</span> clause</a>.</li>
                <li value="3">An <a href="../Clauses/OrderBy.html"><span class="CodeFont">ORDER BY</span> clause</a> (using an alias name) if the aggregate appears in the result of the relevant query block. That is, an alias for an aggregate is permitted in an <a href="../Clauses/OrderBy.html"><span class="CodeFont">ORDER BY</span> clause</a> if
			and only if the aggregate appears in a <span class="ItalicFont">SelectItem</span> in a <span class="ItalicFont"><a href="../Expressions/Select.html">SelectExpression</a>.</span></li>
            </ul>
            <p>All expressions in <span class="ItalicFont">SelectItems</span> in the <span class="ItalicFont"><a href="../Expressions/Select.html">SelectExpression</a></span> must
		be either aggregates or grouped columns (see <a href="../Clauses/GroupBy.html"><span class="CodeFont">GROUP BY</span> clause</a>).(The same is true if there is a <span class="CodeFont">HAVING</span> clause without a <span class="CodeFont">GROUP BY</span> clause.)</p>
            <p>This is because the <span class="ItalicFont">ResultSet</span> of a <span class="ItalicFont"><a href="../Expressions/Select.html">SelectExpression</a></span> must
		be either a scalar (single value) or a vector (multiple values), but not a mixture of both. (Aggregates evaluate to a scalar value, and the referenceto a column can evaluate to a vector.) For example, the following query mixes scalar and vector values and thus is not valid:</p>
            <div class="preWrapper"><pre class="Example" xml:space="preserve">   -- not valid
SELECT MIN(flying_time), flight_id
  FROM Flights;</pre>
            </div>
            <p>Aggregates are not allowed on outer references (correlations). This means that if a subquery contains an aggregate, that aggregate cannot evaluate an expression that includes a reference to a column in the outer query block. For example, the following query is not valid because SUM operates on a column from the outer query:</p>
            <div class="preWrapper"><pre class="Example" xml:space="preserve">SELECT c1
  FROM t1
  GROUP BY c1
  HAVING c2 &gt;
  SELECT t2.x
  FROM t2
  WHERE t2.y = SUM(t1.c3));</pre>
            </div>
            <h2><a name="Window"></a>Using Window Functions</h2>
            <p>Window functions, sometimes referred to as <span class="ItalicFont">analytic</span> functions, perform calculations across a set of table rows that are related to the current row. They are similar to aggregate functions, with several significant differences; a window function:</p>
            <ul>
                <li value="1">Always includes an <span class="CodeFont"><a href="../Clauses/Over.html">OVER</a></span>&#160;clause</li>
                <li value="2">Outputs one row for each input value it operates upon.</li>
                <li value="3">Groups rows with window partitioning and frame clauses, rather than using <span class="CodeFont"><a href="../Clauses/GroupBy.html">GROUP BY</a></span> clauses</li>
            </ul>
            <p class="noteNote" data-mc-autonum="NOTE: &#160;"><span class="autonumber"><span class="noteAutoNum">NOTE: &#160;</span></span>Most developers who are new to window functions find that the easiest way to understand them is to view examples, such as the ones in the <a href="../../Developers/Fundamentals/UsingWindowFunctions.html">Window Functions</a> topic in our <span class="ItalicFont">Splice Machine Developer's Guide</span>.</p>
            <p>Window functions can be used to handle complex analysis and reporting. For example, it's easy to output running totals, moving averages for a specific time frame, and similar functions. There are a few simple rules about window function usage you need to know:</p>
            <ul>
                <li value="1">Window functions are permitted only in the <span class="CodeFont">SELECT</span> list and the <span class="CodeFont">ORDER BY</span> clause of the query. They are forbidden elsewhere, such as in <span class="CodeFont">GROUP BY</span>, <span class="CodeFont">HAVING</span> and <span class="CodeFont">WHERE</span> clauses. These restrictions are due to the fact that window functions execute after the processing of those clauses.</li>
                <li value="2">You can include an aggregate function call in the arguments to a window function; however, you cannot include a window function in the arguments to a regular aggregate function. This is again due to the fact that window functions execute after regular aggregate functions have executed.</li>
                <li value="3"> When the function runs, a window of rows is computed in relation to the current row; as the current row advances, the window moves along with it.</li>
            </ul>
            <p>The rows considered by a window function (its input rows)&#160;are those of the <span class="ItalicFont">virtual table</span> produced by the query's <span class="CodeFont">FROM</span> clause as filtered by its <span class="CodeFont">WHERE</span>, <span class="CodeFont">GROUP BY</span>, and <span class="CodeFont">HAVING</span> clauses, if any. This means, for example, that a row removed because it does not meet the <span class="CodeFont">WHERE</span> condition is not seen by any window function. A query can contain multiple window functions that slice up the data in different ways by means of different <span class="CodeFont">OVER</span> clauses, but they all act on the same collection of rows defined by this virtual table.</p>
            <p>For examples and further explanation of window functions, please see the <a href="../../Developers/Fundamentals/UsingWindowFunctions.html">Window Functions</a> topic in our <span class="ItalicFont">Splice Machine Developer's Guide</span>.</p>
            <p class="heading2">See Also</p>
            <ul>
                <li value="1"><a href="../DataTypes/Intro.NumericTypes.html">About Data Types</a>
                </li>
                <li value="2"><a href="CurrentDate.html"><span class="CodeFont">AVG</span></a> function</li>
                <li value="3"><a href="Count.html"><span class="CodeFont">COUNT</span></a> function</li>
                <li value="4"><a href="DenseRank.html"><span class="CodeFont">DENSE_RANK</span></a>&#160;function</li>
                <li value="5"><a href="FirstValue.html"><span class="CodeFont">FIRST_VALUE</span></a>&#160;function</li>
                <li value="6"><a href="Lag.html"><span class="CodeFont">LAG</span></a>&#160;function</li>
                <li value="7"><a href="LastValue.html"><span class="CodeFont">LAST_VALUE</span></a>&#160;function</li>
                <li value="8"><a href="Lead.html"><span class="CodeFont">LEAD</span></a>&#160;function</li>
                <li value="9"><a href="Max.html"><span class="CodeFont">MAX</span></a> function</li>
                <li value="10"><a href="Min.html"><span class="CodeFont">MIN</span></a> function</li>
                <li value="11"><a href="Rank.html"><span class="CodeFont">RANK</span></a>&#160;function</li>
                <li value="12"><a href="RowNumber.html"><span class="CodeFont">ROW_NUMBER</span></a>&#160;function</li>
                <li value="13"><a href="Sum.html"><span class="CodeFont">SUM</span></a> function</li>
                <li value="14"><a href="../Expressions/Select.html"><span class="CodeFont">SELECT</span></a> expression</li>
                <li value="15"><a href="../Clauses/GroupBy.html"><span class="CodeFont">GROUP&#160;BY</span></a>&#160;clause</li>
                <li value="16"><a href="../Clauses/Having.html"><span class="CodeFont">HAVING</span></a>&#160;clause</li>
                <li value="17"><a href="../Clauses/OrderBy.html"><span class="CodeFont">ORDER&#160;BY</span></a>&#160;clause</li>
                <li value="18"><span class="ItalicFont"><a href="../../Developers/Fundamentals/UsingWindowFunctions.html">Using Window Functions</a></span> in the <span class="ItalicFont">Developer Guide</span>.</li>
            </ul>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
        </div>
    </body>
</html>