<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="withMenu" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-conditions="Review.ReviewOff" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developer's Guide|Functions and Stored Procedures">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="Examples of creating and using database functions and stored procedures." /><title>Examples of Splice Machine Functions and Procedures</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Resources/Stylesheets/SpliceTriPaneStyles.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#Shared/Developers/FcnsAndProcs/ProcAndFcnExamples.html">Open topic with navigation</a>
        </p>
        <div class="TopicContent">
            <h1>Examples of Splice Machine Functions and Stored Procedures </h1>
            <p>This topic walks you through creating, storing, and using a sample database function and a sample database stored procedure, in these sections:</p>
            <ul>
                <li value="1"><a href="#CreatingSampleFunction">Creating and Using a Sample Function in Splice Machine</a>
                </li>
                <li value="2"><a href="#CreatingSampleProc">Creating and Using a Sample Stored Procedure in Splice Machine</a>
                </li>
            </ul>
            <h2><a name="CreatingSampleFunction"></a>Creating and Using a Sample Function in Splice Machine</h2>
            <p>This section walks you through creating a sample function named <span class="CodeFont">word_limiter</span> that limits the number of words in a string; for example, given this sentence:</p>
            <blockquote>
                <p><span class="AppCommand">Today is a wonderful day and I am looking forward to going to the beach.</span>
                </p>
            </blockquote>
            <p>If you tell <span class="CodeFont">word_limiter</span> to return the first five words in the sentence, the returned string would be:</p>
            <blockquote>
                <p><span class="AppCommand">Today is a wonderful day</span>
                </p>
            </blockquote>
            <p>Follow these steps to define and use the <span class="CodeFont">word_limiter</span> function:</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Define inputs and outputs</p>
                        <p class="indentLevel1">We have two inputs:</p>
                        <ul class="plainFont">
                            <li value="1">the sentence that we want to limit</li>
                            <li value="2">the number of words we want to limit the output to</li>
                        </ul>
                        <p class="indentLevel1">The output is a string that contains the limited words.</p>
                    </li>
                    <li value="2">
                        <p class="topLevel">Create the shell of our Java class.</p>
                        <p class="indentLevel1">We create a class named <span class="CodeFont">ExampleStringFunctions</span> in the package <span class="CodeFont">com.splicemachine.examples</span>. </p>
                        <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
package com.splicemachine.example;

public class ExampleStringFunctions {<br />...
}</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Create the <span class="CodeFont">wordLimiter</span> static method</p>
                        <p class="indentLevel1">This method contains the logic for returning the first n number of words:</p>
                        <div class="gistWrapperWide">
                            <script src="https://gist.github.com/ghillerson/5c1bdedb3f0327af9ecc35214087c09e.js">
                            </script>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel">Compile the class and store the jar file</p>
                        <p class="indentLevel1">After you compile your class, make sure that the jar file is in a directory in your <span class="CodeFont">classpath</span>, so that it can be found. You can find more information about this in the <a href="StoringAndUpdatingFcnsAndProcs.html">Storing and Updating Functions and Stored Procedures</a> topic in this section. </p>
                        <p class="indentLevel1">If you're using the standalone version of Splice Machine, you can use the following command line interface command:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SQLJ.INSTALL_JAR('/Users/me/dev/workspace/examples/bin/example.jar', 'SPLICE.MY_EXAMPLE_APP', 0);</pre>
                        </div>
                        <p class="indentLevel1">You must also update the database class path:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', 'SPLICE.MY_EXAMPLE_APP');</pre>
                        </div>
                    </li>
                    <li value="5">
                        <p class="topLevel">Define the function in Splice Machine</p>
                        <p class="indentLevel1">You can find the complete syntax for <span class="CodeFont"><a href="../../SQLReference/Statements/CreateFunction.html">CREATE&#160;FUNCTION</a></span>&#160;in the <span class="ItalicFont">Splice Machine SQL&#160;Reference</span> manual. For our example function, we enter the following command at the <span class="CodeFont">splice&gt;</span>&#160;prompt:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;CREATE FUNCTION WORD_LIMITER(MY_SENTENCE VARCHAR(9999), NUM_WORDS INT) RETURNS VARCHAR(9999)
LANGUAGE JAVA
PARAMETER STYLE JAVA
NO SQL
EXTERNAL NAME 'com.splicemachine.example.ExampleStringFunctions.wordLimiter';</pre>
                        </div>
                    </li>
                    <li value="6">
                        <p class="topLevel">Run the function</p>
                        <p class="indentLevel1">You can run the function with this syntax:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;SELECT WORD_LIMITER('Today is a wonderful day and I am looking forward to going to the beach.', 5)
   FROM&#160;SYSIBM.SYSDUMMY1;</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <h2><a name="CreatingSampleProc"></a>Creating and Using a Sample Stored Procedure in Splice Machine</h2>
            <p>In this section , we create a stored procedure named <span class="CodeFont">GET_INVENTORY_FOR_SKU</span> that retrieves all of the inventory records for a specific product by using the product's sku code. The input to this procedure is the sku code, and the output is a resultset of records from the inventory table.</p>
            <p>Follow these steps to define and use the <span class="CodeFont">GET_INVENTORY_FOR_SKU</span> function:</p>
            <div class="opsStepsList">
                <ol class="boldFont">
                    <li value="1">
                        <p class="topLevel">Create and populate the inventory table</p>
                        <p class="indentLevel1">Connect to Splice Machine and create the following table from the command prompt or from an SQL&#160;client, using the following statements:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
CREATE&#160;TABLE&#160;INVENTORY (
   SKU_CODE&#160;VARCHAR(30),
   WAREHOUSE&#160;BIGINT,
&#160;  QUANTITY&#160;BIGINT
);

INSERT INTO INVENTORY VALUES ('ABC123',1,50),('ABC123',2,100),('ABC123',3,60),('XYZ987',1,20),('XYZ321',2,0); </pre>
                        </div>
                    </li>
                    <li value="2">
                        <p class="topLevel">Create the shell of our Java class.</p>
                        <p class="indentLevel1">We create a class named <span class="CodeFont">ExampleStringFunctions</span> in the package <span class="CodeFont">com.splicemachine.examples</span>. </p>
                        <div class="preWrapperWide"><pre class="Example" xml:space="preserve">
package com.splicemachine.example;

public class ExampleStoredProcedure{<br />...
}</pre>
                        </div>
                    </li>
                    <li value="3">
                        <p class="topLevel">Create the <span class="CodeFont">getSkuInventory</span> static method</p>
                        <p class="indentLevel1">This method contains the logic for retrieving inventory records for the specified sku.</p>
                        <div class="gistWrapperWide">
                            <script src="https://gist.github.com/ghillerson/e9eda06ed8d95de7bff48d47aa112135.js">
                            </script>
                        </div>
                    </li>
                    <li value="4">
                        <p class="topLevel">Compile the class and store the jar file</p>
                        <p class="indentLevel1">After you compile your class, make sure that the jar file is in a directory in your <span class="CodeFont">classpath</span>, so that it can be found. You can find more information about this in the <a href="StoringAndUpdatingFcnsAndProcs.html">Storing and Updating Functions and Stored Procedures</a> topic in this section. </p>
                        <p class="indentLevel1">If you're using the standalone version of Splice Machine, you can use the following command line interface command:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SQLJ.INSTALL_JAR('/Users/me/dev/workspace/examples/bin/example.jar', 'SPLICE.GET_SKU_INVENTORY', 0);</pre>
                        </div>
                        <p class="indentLevel1">You must also update the database class path:                <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;CALL&#160;SYSCS_UTIL.SYSCS_SET_DATABASE_PROPERTY('derby.database.classpath', 'SPLICE.GET_SKU_INVENTORY');</pre></div></p>
                    </li>
                    <li value="5">
                        <p class="topLevel">Define the procedure in Splice Machine</p>
                        <p class="indentLevel1">For our procedure, we enter the following command at the <span class="CodeFont">splice&gt;</span>&#160;prompt:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">
splice&gt;&#160;CREATE PROCEDURE GET_INVENTORY_FOR_SKU(SKU_CODE VARCHAR(30))
LANGUAGE JAVA
PARAMETER STYLE JAVA
READS&#160;SQL&#160;DATA
EXTERNAL NAME 'com.splicemachine.example.ExampleStoredProcedure.getSkuInventory';</pre>
                        </div>
                    </li>
                    <li value="6">
                        <p class="topLevel">Run the stored procedure</p>
                        <p class="indentLevel1">You can run the procedure with this syntax:</p>
                        <div class="preWrapperWide"><pre class="AppCommand" xml:space="preserve">splice&gt;&#160;call GET_INVENTORY_FOR_SKU('ABC123');</pre>
                        </div>
                    </li>
                </ol>
            </div>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
        </div>
    </body>
</html>