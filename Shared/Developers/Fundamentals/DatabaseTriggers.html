<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="withMenu" data-mc-search-type="Stem" data-mc-help-system-file-name="index.xml" data-mc-path-to-help-system="../../../" data-mc-conditions="Review.ReviewOff" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Developer's Guide|Fundamentals">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="description" content="Describes database triggers and how you can use them with Splice Machine." /><title>Using Database Triggers in Splice Machine</title>
        <link href="../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../../Resources/Stylesheets/SpliceTriPaneStyles.css" rel="stylesheet" />
        <script src="../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../index.html#Shared/Developers/Fundamentals/DatabaseTriggers.html">Open topic with navigation</a>
        </p>
        <div class="TopicContent">
            <h1>Using Database Triggers</h1>
            <p>This topic describes database triggers and how you can use them with Splice Machine.</p>
            <h2>About Database Triggers</h2>
            <p>A database trigger is procedural code that is automatically executed in response to certain events on a particular table or view in a database. Triggers are mostly used for maintaining the integrity of the information on the database; they are most commonly used to:</p>
            <ul>
                <li value="1">automatically generate derived column values</li>
                <li value="2">enforce complex security authorizations</li>
                <li value="3">enforce referential integrity across nodes in a distributed database</li>
                <li value="4">enforce complex business rules</li>
                <li value="5">provide transparent event logging</li>
                <li value="6">provide sophisticated auditing</li>
                <li value="7">gather statistics on table access</li>
            </ul>
            <h3>Components of a Trigger</h3>
            <p>Each trigger has two required components:</p>
            <table summary="Descriptions of trigger components.">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Triggering event (or statement)</td>
                        <td>
                            <p class="noSpaceAbove">The SQL statement that causes a trigger to be fired. This can be one of the following types of statement:</p>
                            <ul>
                                <li class="CodeFont" value="1">INSERT</li>
                                <li class="CodeFont" value="2">UPDATE</li>
                                <li class="CodeFont" value="3">DELETE</li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <td>Trigger action</td>
                        <td>
                            <p class="noSpaceAbove">The procedure that contains the SQL statements to be executed when a triggering statement is issued and any trigger restrictions evaluate to <span class="CodeFont">TRUE</span>. </p>
                            <p>A trigger action is one of the following:</p>
                            <ul>
                                <li value="1">arbitrary SQL</li>
                                <li value="2">a call to a <a href="../../SQLReference/BuiltInSysProcs/Intro.BuiltInSysProcs.html">built-in stored procedure</a> or <a href="../FcnsAndProcs/Intro.FcnsAndProcs.html">user-defined stored procedure</a></li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3>When a Trigger Fires</h3>
            <p>You can define both statement and row triggers as either <span class="ItalicFont">before triggers</span> or <span class="ItalicFont">after triggers</span>:</p>
            <table summary="Before triggers and after triggers.">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Trigger Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="ItalicFont">Before Triggers</td>
                        <td>A before trigger fires before the statement's changes are applied and before any constraints have been applied.</td>
                    </tr>
                    <tr>
                        <td class="ItalicFont">After Triggers</td>
                        <td>An after trigger fires after all constraints have been satisfied and after the changes have been applied to the target table. </td>
                    </tr>
                </tbody>
            </table>
            <h3>How Often a Trigger Fires</h3>
            <p>You can define triggers as either <span class="ItalicFont">statement triggers</span> or <span class="ItalicFont">row triggers</span>, which defines how often a trigger will fire for a triggering event.</p>
            <table summary="Statement triggers and row triggers.">
                <col />
                <col />
                <thead>
                    <tr>
                        <th>Trigger Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="ItalicFont">Statement Triggers</td>
                        <td>A statement trigger fires once per triggering event, regardless of how many rows (including zero rows) are modified by the event.</td>
                    </tr>
                    <tr>
                        <td class="ItalicFont">Row Triggers</td>
                        <td>
                            <p>A row trigger fires once for each row that is affected by the triggering event; for example, each row modified by an <span class="CodeFont">UPDATE</span>&#160;statement. If no rows are affected by the event, the trigger does not fire.</p>
                        </td>
                    </tr>
                </tbody>
            </table>
            <div class="indented">
                <p class="noteNote" data-mc-autonum="NOTE: &#160;"><span class="autonumber"><span class="noteAutoNum">NOTE: &#160;</span></span>Triggers are statement triggers by default. You specify a row trigger in the <span class="CodeFont">FOR&#160;EACH</span>&#160;clause of the <span class="CodeFont"><a href="../../SQLReference/Statements/CreateTrigger.html">CREATE&#160;TRIGGER</a></span>&#160;statement.</p>
            </div>
            <h2>Examples</h2>
            <p>This section presents examples of using database triggers.</p>
            <h3>Example 1: Row Level AFTER Trigger</h3>
            <p>This example shows a row level trigger that is called after a row is updated in the <span class="CodeFont">employees</span> table. The action of this trigger is to insert one record into the audit trail table (<span class="CodeFont">employees_log</span>) for each record that gets updated in the <span class="CodeFont">employees</span> table.</p>
            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">CREATE TRIGGER log_salary_increase<br />AFTER UPDATE ON employees FOR EACH ROW<br />   INSERT INTO employees_log<br />     (emp_id, log_date, new_salary, action)<br />   VALUES<br />     (:new.empno, CURRENT_DATE, :new.salary, 'NEW&#160;SALARY');<br /></pre>
            </div>
            <p>If you then issue following statement to update salaries of all employees in the PD&#160;department:</p>
            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">UPDATE employees SET salary = salary +&#160;1000.0 WHERE department = 'PD';</pre>
            </div>
            <p>Then the trigger will fire once (and one audit record will be inserted)&#160;for each employee in the department named <span class="CodeFont">PD</span>. </p>
            <h3>Example 2:&#160;Statement Level After Trigger</h3>
            <p>This example shows a statement level trigger that is called after the <span class="CodeFont">employees</span> table is updated. The action of this trigger is to insert exactly one record into the change history table (<span class="CodeFont">reviews_history</span>) whenever the <span class="CodeFont">employee_reviews</span> table is updated.</p>
            <p>This example shows a row level trigger that is called after a row is updated in the <span class="CodeFont">employees</span> table. The action of this trigger is to insert one record into the audit trail table (<span class="CodeFont">employees_log</span>) for each record that gets updated in the <span class="CodeFont">employees</span> table.</p>
            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">CREATE TRIGGER log_salary_increase
AFTER UPDATE ON employees referencing NEW as NEW FOR EACH ROW
INSERT INTO employees_log
(emp_id, log_date, new_salary, action)
VALUES
(NEW.empno, CURRENT_DATE, NEW.salary, 'NEW SALARY');<br /></pre>
            </div>
            <p>If you then issue the same Update statement as used in the previous example:</p>
            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">UPDATE employees SET salary = salary +&#160;1000.0 WHERE department = 'PD';</pre>
            </div>
            <p>Then the trigger will fire once and exactly one record will be inserted into the <span class="CodeFont">employees_log</span> table, no matter how many records are updated by the statement.</p>
            <h3>Example 3: Statement Level Before Trigger</h3>
            <p>This example shows a row level trigger that is called before a row is inserted into the <span class="CodeFont">employees</span> table.</p>
            <div class="preWrapperWide"><pre class="Example" xml:space="preserve">CREATE TRIGGER empUpdateTrig<br />BEFORE UPDATE&#160;ON employees<br />   FOR EACH STATEMENT SELECT ID FROM myTbl;<br /></pre>
            </div>
            <h2>See Also</h2>
            <ul>
                <li value="1"><span class="CodeFont"><a href="../../SQLReference/Statements/CreateTrigger.html">CREATE TRIGGER</a></span> statement in the <span class="ItalicFont">SQL&#160;Reference Manual</span></li>
                <li value="2"><span class="CodeFont"><a href="../../SQLReference/Statements/DropTrigger.html">DROP&#160;TRIGGER</a></span>&#160;statement in the <span class="ItalicFont">SQL&#160;Reference Manual</span></li>
                <li value="3"><a href="ForeignKeys.html">Foreign keys</a>
                </li>
                <li value="4"><span class="CodeFont"><a href="../../SQLReference/Statements/UpdateTable.html">UPDATE</a></span>&#160;statement in the <span class="ItalicFont">SQL&#160;Reference Manual</span></li>
                <li value="5"><span class="CodeFont"><a href="../../SQLReference/Clauses/Where.html">WHERE</a></span> clause in the <span class="ItalicFont">SQL&#160;Reference Manual</span></li>
            </ul>
            <p style="font-size: 6pt;margin-top: 0;margin-bottom: 0;">&#160;</p>
        </div>
    </body>
</html>